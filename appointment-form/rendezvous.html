<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment List</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="max-w-3xl mx-auto p-4 mt-10">
        <h2 class="text-2xl font-bold text-center text-gray-700 mb-4">Appointment List</h2>
        
        <!-- Appointment List -->
        <ul id="appointmentList" class="space-y-4"></ul>
        
        <!-- Modify Appointment Form -->
        <div id="modifyForm" class="hidden mt-6 bg-white p-4 rounded-lg shadow-md">
            <h3 class="text-xl font-bold mb-4">Modify Appointment</h3>
            <form id="updateAppointmentForm">
                <label class="block mb-2">Email:</label>
                <input type="email" id="updateEmail" class="w-full p-2 border border-gray-300 rounded-md mb-4" required />

                <label class="block mb-2">Doctor:</label>
                <input type="text" id="updateDoctor" class="w-full p-2 border border-gray-300 rounded-md mb-4" required />

                <label class="block mb-2">Appointment Date:</label>
                <input type="datetime-local" id="updateAppointmentDate" class="w-full p-2 border border-gray-300 rounded-md mb-4" required />

                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-md">Update Appointment</button>
                <button type="button" id="cancelModifyBtn" class="bg-gray-500 text-white px-4 py-2 rounded-md ml-2">Cancel</button>
            </form>
        </div>
    </div>

    <script>
        // Fetch the list of appointments
        async function fetchAppointments() {
            try {
                const response = await axios.get('http://localhost:5000/api/appointments');
                const appointments = response.data;
                const list = document.getElementById('appointmentList');
                list.innerHTML = "";

                appointments.forEach((appointment) => {
                    const li = document.createElement('li');
                    li.className = "bg-white p-4 rounded-lg shadow-md flex justify-between items-center";
                    li.innerHTML = `
                        <div>
                            <p><strong>Email:</strong> ${appointment.email}</p>
                            <p><strong>Doctor:</strong> ${appointment.doctor}</p>
                            <p><strong>Date:</strong> ${appointment.appointmentDate}</p>
                        </div>
                        <div>
                            <button onclick="deleteAppointment('${appointment._id}')" class="bg-red-500 text-white px-4 py-2 rounded-md mr-2">Delete</button>
                            <button onclick="editAppointment('${appointment._id}')" class="bg-yellow-500 text-white px-4 py-2 rounded-md">Edit</button>
                        </div>
                    `;
                    list.appendChild(li);
                });
            } catch (error) {
                console.error("Error fetching appointments:", error);
            }
        }

        // Delete an appointment
        async function deleteAppointment(id) {
            try {
                await axios.delete(`http://localhost:5000/api/appointments/${id}`);
                fetchAppointments(); // Refresh the list
            } catch (error) {
                console.error("Error deleting appointment:", error);
            }
        }

        // Edit an appointment
        async function editAppointment(id) {
            try {
                const response = await axios.get(`http://localhost:5000/api/appointments/${id}`);
                const appointment = response.data;

                // Prefill the form with the current details
                document.getElementById('updateEmail').value = appointment.email;
                document.getElementById('updateDoctor').value = appointment.doctor;
                document.getElementById('updateAppointmentDate').value = appointment.appointmentDate;

                // Show the modify form
                document.getElementById('modifyForm').classList.remove('hidden');
                
                // Handle form submission to update the appointment
                const updateForm = document.getElementById('updateAppointmentForm');
                updateForm.onsubmit = async (event) => {
                    event.preventDefault();

                    const updatedAppointment = {
                        email: document.getElementById('updateEmail').value,
                        doctor: document.getElementById('updateDoctor').value,
                        appointmentDate: document.getElementById('updateAppointmentDate').value
                    };

                    try {
                        await axios.put(`http://localhost:5000/api/appointments/${id}`, updatedAppointment);
                        fetchAppointments(); // Refresh the list
                        document.getElementById('modifyForm').classList.add('hidden'); // Hide the form
                    } catch (error) {
                        console.error("Error updating appointment:", error);
                    }
                };
                
            } catch (error) {
                console.error("Error fetching appointment data:", error);
            }
        }

        // Cancel modify action
        document.getElementById('cancelModifyBtn').onclick = () => {
            document.getElementById('modifyForm').classList.add('hidden'); // Hide the form
        };

        // Initial fetch of appointments
        fetchAppointments();
    </script>
</body>
</html>
